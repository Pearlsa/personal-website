<!doctype html><html><head><title>How this website (currently) works - charlieegan3</title><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta name=description content="While charlieegan3.com has been my &lsquo;online home&rsquo;, my personal site has gone through various revisions. Personal websites are subject to an above average level of tinkering and experimentation."><meta name=twitter:card content="summary"><meta name=twitter:site content="@charlieegan3"><meta name=twitter:creator content="@charlieegan3"><meta property="og:url" content="https://charlieegan3.com/posts/2017-03-21-how-it-works/"><meta property="og:title" content="How this website (currently) works"><meta property="og:description" content="While charlieegan3.com has been my &lsquo;online home&rsquo;, my personal site has gone through various revisions. Personal websites are subject to an above average level of tinkering and experimentation."><meta property="og:type" content="article"><meta name=author content="Charlie Egan"><meta property="article:author" content="https://twitter.com/charlieegan3"><meta property="article:published_time" content="2017-03-21T00:48:53"><link rel=stylesheet type=text/css href=/css/bundle.min.c144bb18591ee3d9ef85fb73056afa69f6c8fa31188080cb491de5b71bbf36e1.css><script type=text/javascript src=/js/bundle.min.76c0ad1f61fe83a23628b79ecc5aa835224071f00c5f2a4fbbdf26765027d8e7.js integrity="sha256-dsCtH2H+g6I2KLeezFqoNSJAcfAMXypPu98mdlAn2Oc="></script></head><body class="bg-darker-gray light-silver"><section class="mw7 center pa3 ph5-ns pb5"><nav class=sidebar-nav><a href=/ title=homepage>home</a>
<a href=/about/ title="read all about it">about</a>
<a class="bb bw1 b--silver" href=/posts/ title="view my blog posts">posts</a>
<a href=/projects/ title="view my projects">projects</a>
<a href=/profiles/ title="find me elsewhere">profiles</a>
<a href=/search><img class="fr grow" style=width:20px;filer:invert(.75);-webkit-filter:invert(.75) src=/search.svg></a></nav><h1 class="f3-ns f4">How this website (currently) works</h1><div class="f5-ns f6 gray bb bw1 pb2 b--dark-gray">Posted Mar 21 2017</div><div class=post-content><p>While <em>charlieegan3.com</em> has been my &lsquo;online home&rsquo;, my personal site has gone through various revisions. Personal websites are subject to an above average level of tinkering and experimentation. I thought it time to pause and write about the interesting elements of the current setup.</p><p>I&rsquo;ve been using a static site generated using middleman since the <a href=https://github.com/charlieegan3/personal-website/commit/5687489e86540f48d6760d7f1de6060a04b7abc6>end of 2015</a>. What started happily as a GitHub pages site <a href=https://github.com/charlieegan3/personal-website/commit/5a09e57763d8b16b5f6a4efe4630736e8718606c>moved</a> to Netlify last year to take advantage of their free HTTPS on custom domains. I really enjoyed using Netlify and think it&rsquo;s a great tool. At the end of last year; after attending GCPNext I got into playing with the the (free) App Engine Standard environment - <em>charlieegan3.com</em> was the simplest project of mine that I could use to try it out. Most of my projects are Ruby-based and you can&rsquo;t run Ruby on the free App Engine tier. It was time to move, again. Here&rsquo;s the setup I&rsquo;ve arrived at - it&rsquo;s one I&rsquo;m fairly happy with.</p><h2 id=wercker>Wercker</h2><p>Prior to my App Engine experiments, I also looked into the Google Container Engine for hosting some of my other more involved projects. I found a tool called <a href=https://www.wercker.com>wercker</a> that I liked the &lsquo;interface&rsquo; for and was keen to keep using on the App Engine for my personal site. The wercker config file; where each pipeline starts from a container image (e.g. one ready to build my site or equipped with the gcloud tooling for deployment) made a lot of sense. So my wercker workflow looks a little like this:</p><ol><li><strong>Build</strong> - starting point image: <code>ruby:2.3.3</code></li></ol><ul><li>clone the source</li><li>bundle install</li><li>middleman build -> build directory</li></ul><ol start=2><li><strong>Deploy</strong> - starting point image: <code>google/cloud-sdk</code></li></ol><ul><li>(only ran if build completed successfully)</li><li>(using the build artefact from the last pipeline)</li><li>deploy the site to the app engine using the gcloud toolchain.</li></ul><p>I&rsquo;ve found basing each pipeline step in the workflow on a &lsquo;pre-loaded&rsquo; image like this makes the deployments quite quick - under 2 mins to build and publish the site.</p><h2 id=automatic-broken-link-checking>Automatic broken link checking</h2><p>I had imported my old posts from Tumblr some time ago but hadn&rsquo;t bothered to check them all for broken links (I found the <a href=https://www.npmjs.com/package/broken-link-checker>broken-link-checker</a> to be the best thing for this task). I also realised that my <code>app.yaml</code> handlers where not serving some of my post attachments. After fixing this issues I thought it&rsquo;d be nice to automate checking internal links before deploying.</p><p>I toyed with the idea of serving the site with one process and running the checker against it in a <code>Link Test</code> wercker pipeline. After some looking around I found <a href=https://github.com/gjtorikian/html-proofer>HTMLProofer</a>, a gem for checking validating static HTML. With the help of a little monkey patching to sort out an encoding issue I was able to set this up as an <a href=https://github.com/charlieegan3/personal-website/commit/0e7eac36c74d41baf89f6ac50d02ac930bc5aaea#diff-2620489c404159b5404f13f82e470fbdR109>after_build callback</a>.</p><p>Now if I try and deploy a broken link or a page that renders to invalid HTML the site won&rsquo;t deploy.</p><h2 id=live-status>Live Status</h2><p>I have a task that runs every 10 mins on Heroku to update the live sections on the homepage. This is a <a href=https://github.com/charlieegan3/json-charlieegan3>separate repo</a> and is basically a set of scrapers and API clients for a number of sites and services I use around the web. The task gathers all the latest data from each service and pushes the result to a <a href=https://github.com/charlieegan3/json-charlieegan3>json file</a> in a storage bucket. There is also a <a href=/status.json>fallback copy</a> of the status file saved into the build directory when this site is built. This project is pretty hacked together; I&rsquo;d like to make it more modular but for now it does the job. I think the live sections on the homepage are a nice feature.</p><h2 id=noscript-friendly>Noscript Friendly</h2><p>Until this last weekend the site didn&rsquo;t load correctly without Javascript, shame; shame. The good news is that it now works fine. The live status panels only display in when the data&rsquo;s there and the page re-arranges itself. I&rsquo;ve also opted to add turbolinks to the site as it makes switching pages faster and gracefully degrades in the absence of Javascript.</p><hr><p>I think it&rsquo;s interesting to explore what we can do with a &ldquo;static site&rdquo; and think simple projects like this are often a place to try out new things that might be harder to justify in more involved applications.</p></div></section></body></html>